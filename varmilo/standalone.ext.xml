<?xml version="1.1" encoding="utf-8"?>
<!--
    File    : standalone.xml
    Summary : Paytronix WildFly 20.0.1 app server instance configuration xml template
              See https://docs.wildfly.org/20/wildscribe/index.html for reference.
-->
<server xmlns="urn:jboss:domain:13.0">
   <extensions>
      <extension module="org.jboss.as.clustering.infinispan"/>
      <extension module="org.jboss.as.connector"/>
      <extension module="org.jboss.as.deployment-scanner"/>
      <extension module="org.jboss.as.ee"/>
      <extension module="org.jboss.as.ejb3"/>
      <extension module="org.jboss.as.jaxrs"/>
      <extension module="org.jboss.as.jdr"/>
      <extension module="org.jboss.as.jmx"/>
      <extension module="org.jboss.as.jpa"/>
      <extension module="org.jboss.as.jsf"/>
      <extension module="org.jboss.as.jsr77"/>
      <extension module="org.jboss.as.logging"/>
      <extension module="org.jboss.as.mail"/>
      <extension module="org.jboss.as.naming"/>
      <extension module="org.jboss.as.pojo"/>
      <extension module="org.jboss.as.remoting"/>
      <extension module="org.jboss.as.sar"/>
      <extension module="org.jboss.as.security"/>
      <extension module="org.jboss.as.transactions"/>
      <extension module="org.jboss.as.webservices"/>
      <extension module="org.jboss.as.weld"/>
      <extension module="org.wildfly.extension.batch.jberet"/>
      <extension module="org.wildfly.extension.bean-validation"/>
      <extension module="org.wildfly.extension.clustering.singleton"/>
      <extension module="org.wildfly.extension.core-management"/>
      <extension module="org.wildfly.extension.elytron"/>
      <extension module="org.wildfly.extension.io"/>
      <extension module="org.wildfly.extension.undertow"/>
   </extensions>
   <system-properties>
      <property name="org.jboss.logging.provider" value="slf4j"/>
      <property name="paytronix.site" value="bos1-px"/>
      <property name="paytronix.configuration.mongo.hosts"
                value="bos1px-app1|bos1px-app2|bos1px-app3"/>
      <property name="paytronix.configuration.mongo.database" value="px_mongo"/>
      <property name="socket_invoker.max_pool_size" value="1000"/>
      <property name="socket_invoker.num_accept_threads" value="3"/>
      <property name="FILE_UPLOAD_MAX_LINES" value="250000"/>
      <property name="CARD_UPLOAD_MAX_LINES" value="1000000"/>
      <property name="SCHEDULED_REPORT_PEN_DIR" value="/opt/pxs/tmp"/>
      <property name="THREADPOOL_MIN_THREADS" value="10"/>
      <property name="THREADPOOL_MAX_THREADS" value="100"/>
      <property name="THREADPOOL_PUT_TIMEOUT_MS" value="2000"/>
      <property name="GC_HOUR" value="3"/>
      <property name="TRANSACTION_LOG_INCLUDE_REQUEST_RESPONSE_MESSAGES" value="false"/>
      <property name="MONITORING_SERVICE_LOG_PATH"
                value="/opt/wildfly-20.0.1/aaa_pxs/transaction_logs"/>
      <property name="ACCOUNT_LOOKUP_DISALLOWED_PHONE_NUMBER_REGEXES"
                value="^(.)\\1*$,555.......,6175551212,1234567890,1231231234"/>
      <property name="LINK_TRACKING_PRIVATE_KEY_FILE_PATH"
                value="/opt/Paytronix/linkclick.private"/>
      <property name="EMAIL_TRACKING_PRIVATE_KEY_FILE_PATH"
                value="/opt/Paytronix/emailopen.private"/>
      <property name="APPLE_PUSH_TOKEN_DECRYPT_KEY_FILE_PATH"
                value="/opt/Paytronix/applepushdecryptPROD.private"/>
      <property name="HTTPS_LISTENER_PORT" value="11283"/>
   </system-properties>
   <management>
      <security-realms>
         <security-realm name="ManagementRealm">
            <authentication>
               <local default-user="$local" skip-group-loading="true"/>
               <users>
                  <user username="admin">
                     <credential-reference store="px-credential-store" alias="management_realm_password"/>
                  </user>
               </users>
            </authentication>
            <authorization map-groups-to-roles="false">
               <properties path="mgmt-groups.properties" relative-to="jboss.server.config.dir"/>
            </authorization>
         </security-realm>
         <security-realm name="ApplicationRealm">
            <authentication>
               <local default-user="$local" allowed-users="*" skip-group-loading="true"/>
               <users>
                  <user username="jmxadmin">
                     <credential-reference store="px-credential-store" alias="application_realm_password"/>
                  </user>
               </users>
            </authentication>
            <authorization>
               <properties path="application-roles.properties"
                           relative-to="jboss.server.config.dir"/>
            </authorization>
         </security-realm>
         <security-realm name="apiPxsweb">
            <server-identities>
               <ssl>
                  <keystore path="/opt/wildfly-20.0.1/aaa_pxs/certs/api.pxsweb.com.keystore">
                     <keystore-password-credential-reference store="px-credential-store" alias="web_keystore_password"/>
                     <key-password-credential-reference store="px-credential-store" alias="web_keystore_password"/>
                  </keystore>
               </ssl>
            </server-identities>
            <authentication>
               <truststore path="/opt/20.0.1/aaa_pxs/certs/rest-client-trust.keystore"
                           keystore-password="nopass"/>
            </authentication>
         </security-realm>
         <security-realm name="https-rest">
            <server-identities>
               <ssl>
                  <keystore path="/opt/wildfly-20.0.1/aaa_pxs/certs/rest.keystore">
                     <keystore-password-credential-reference store="px-credential-store" alias="web_keystore_password"/>
                     <key-password-credential-reference store="px-credential-store" alias="web_keystore_password"/>
                  </keystore>
               </ssl>
            </server-identities>
            <authentication>
               <truststore path="/opt/wildfly-20.0.1/aaa_pxs/certs/rest-client-trust.keystore"
                           keystore-password="nopass"/>
            </authentication>
         </security-realm>
         <security-realm name="https">
            <server-identities>
               <ssl>
                  <keystore path="/opt/wildfly-20.0.1/aaa_pxs/certs/webserver.keystore">
                     <keystore-password-credential-reference store="px-credential-store" alias="web_keystore_password"/>
                     <key-password-credential-reference store="px-credential-store" alias="web_keystore_password"/>
                  </keystore>
               </ssl>
            </server-identities>
         </security-realm>
      </security-realms>
      <audit-log>
         <formatters>
            <json-formatter name="json-formatter"/>
         </formatters>
         <handlers>
            <file-handler name="file"
                          formatter="json-formatter"
                          path="audit-log.log"
                          relative-to="jboss.server.data.dir"/>
         </handlers>
         <logger log-boot="true" log-read-only="false" enabled="false">
            <handlers>
               <handler name="file"/>
            </handlers>
         </logger>
      </audit-log>
      <management-interfaces>
         <http-interface security-realm="ManagementRealm">
            <http-upgrade enabled="true"/>
            <socket-binding http="management-http"/>
         </http-interface>
      </management-interfaces>
      <access-control provider="simple">
         <role-mapping>
            <role name="SuperUser">
               <include>
                  <user name="$local"/>
               </include>
            </role>
         </role-mapping>
      </access-control>
   </management>
   <profile>
      <subsystem xmlns="urn:jboss:domain:logging:8.0">
         <console-handler name="CONSOLE">
            <level name="INFO"/>
            <formatter>
               <named-formatter name="COLOR-PATTERN"/>
            </formatter>
         </console-handler>
         <file-handler name="FILE" autoflush="true">
            <level name="INFO"/>
            <formatter>
               <named-formatter name="PATTERN"/>
            </formatter>
            <file relative-to="jboss.server.log.dir" path="px-ext.log"/>
            <append value="true"/>
         </file-handler>
         <file-handler name="JSON_FILE" autoflush="true">
            <level name="INFO"/>
            <formatter>
               <named-formatter name="JSON"/>
            </formatter>
            <file relative-to="jboss.server.log.dir" path="px-ext.json"/>
            <append value="true"/>
         </file-handler>
         <logger category="akka">
            <level name="INFO"/>
         </logger>
         <logger category="com.amazonaws">
            <level name="INFO"/>
         </logger>
         <logger category="com.arjuna">
            <level name="WARN"/>
         </logger>
         <logger category="com.paytronix">
            <level name="INFO"/>
         </logger>
         <logger category="com.sun.mail.smtp">
            <level name="INFO"/>
         </logger>
         <logger category="javax.enterprise">
            <level name="INFO"/>
         </logger>
         <logger category="javax.activation">
            <level name="INFO"/>
         </logger>
         <logger category="org.apache.http">
            <level name="INFO"/>
         </logger>
         <logger category="org.apache.tomcat.util.modeler">
            <level name="WARN"/>
         </logger>
         <logger category="org.jboss.as.config">
            <level name="INFO"/>
         </logger>
         <logger category="org.jboss.ejb">
            <level name="INFO"/>
         </logger>
         <logger category="org.jboss.jca">
            <level name="INFO"/>
         </logger>
         <logger category="org.jboss.security">
            <level name="INFO"/>
         </logger>
         <logger category="org.http4s">
            <level name="INFO"/>
         </logger>
         <logger category="undertow.request">
            <level name="INFO"/>
         </logger>
         <logger category="io.undertow.request">
            <level name="INFO"/>
         </logger>
         <logger category="as.server">
            <level name="INFO"/>
         </logger>
         <logger category="sun.rmi">
            <level name="WARN"/>
         </logger>
         <logger category="jacorb">
            <level name="WARN"/>
         </logger>
         <logger category="jacorb.config">
            <level name="ERROR"/>
         </logger>
         <logger category="com.microsoft.sqlserver.jdbc">
            <level name="INFO"/>
         </logger>
         <logger category="org.hornetq">
            <level name="INFO"/>
         </logger>
         <logger category="org.mongodb">
            <level name="INFO"/>
         </logger>
         <logger category="net.snowflake">
            <level name="INFO"/>
         </logger>
         <logger category="comet_trace">
            <level name="INFO"/>
         </logger>
         <logger category="org.jboss.remoting.transport.socket.ServerThread">
            <level name="OFF"/>
         </logger>
         <root-logger>
            <level name="INFO"/>
            <handlers>
                    <!--<handler name="CONSOLE"/>-->
               <handler name="FILE"/>
               <handler name="JSON_FILE"/>
            </handlers>
         </root-logger>
         <formatter name="PATTERN">
            <pattern-formatter pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} [%t] %-5p %25c{2} %X{px}- %s%E%n"/>
         </formatter>
         <formatter name="COLOR-PATTERN">
            <pattern-formatter pattern="%K{level}%d{HH:mm:ss,SSS} [%t] %-5p %25c{2} %X{px}- %s%E%n"/>
         </formatter>
         <formatter name="JSON">
            <json-formatter>
                    <!-- If we don't set this the human-friendly string stacktrace isn't rendered, and we just get some JSON representing the stacktrace frames -->
               <exception-output-type value="detailed-and-formatted"/>
            </json-formatter>
         </formatter>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:batch-jberet:2.0">
         <default-job-repository name="in-memory"/>
         <default-thread-pool name="batch"/>
         <job-repository name="in-memory">
            <in-memory/>
         </job-repository>
         <thread-pool name="batch">
            <max-threads count="10"/>
            <keepalive-time time="30" unit="seconds"/>
         </thread-pool>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:bean-validation:1.0"/>
      <subsystem xmlns="urn:jboss:domain:core-management:1.0"/>
      <subsystem xmlns="urn:jboss:domain:deployment-scanner:2.0">
         <deployment-scanner path="deployments"
                             relative-to="jboss.server.base.dir"
                             scan-interval="1000"
                             auto-deploy-zipped="false"
                             auto-deploy-exploded="false"/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:ee:5.0">
         <global-modules>
            <module name="javax.api"/>
            <module name="javax.activation.api"/>
            <module name="javax.mail.api"/>
            <module name="org.jboss.as.system-jmx"/>
            <module name="org.jboss.common-core"/>
            <module name="org.jboss.ironjacamar.jdbcadapters"/>
            <module name="org.apache.xerces"/>
            <module name="net.jcip"/>
            <module xmlns="urn:jboss:domain:13.0" name="com.paytronix.ext.lib"/>
         </global-modules>
         <spec-descriptor-property-replacement>false</spec-descriptor-property-replacement>
         <concurrent>
            <context-services>
               <context-service name="default"
                                jndi-name="java:jboss/ee/concurrency/context/default"
                                use-transaction-setup-provider="true"/>
            </context-services>
            <managed-thread-factories>
               <managed-thread-factory name="default"
                                       jndi-name="java:jboss/ee/concurrency/factory/default"
                                       context-service="default"/>
            </managed-thread-factories>
            <managed-executor-services>
               <managed-executor-service name="default"
                                         jndi-name="java:jboss/ee/concurrency/executor/default"
                                         context-service="default"
                                         hung-task-threshold="60000"
                                         core-threads="5"
                                         max-threads="25"
                                         keepalive-time="5000"/>
            </managed-executor-services>
            <managed-scheduled-executor-services>
               <managed-scheduled-executor-service name="default"
                                                   jndi-name="java:jboss/ee/concurrency/scheduler/default"
                                                   context-service="default"
                                                   hung-task-threshold="60000"
                                                   core-threads="2"
                                                   keepalive-time="3000"/>
            </managed-scheduled-executor-services>
         </concurrent>
         <default-bindings context-service="java:jboss/ee/concurrency/context/default"
                           jms-connection-factory="java:jboss/DefaultJMSConnectionFactory"
                           managed-executor-service="java:jboss/ee/concurrency/executor/default"
                           managed-scheduled-executor-service="java:jboss/ee/concurrency/scheduler/default"
                           managed-thread-factory="java:jboss/ee/concurrency/factory/default"/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:ejb3:7.0">
         <session-bean>
            <stateful default-access-timeout="5000"
                      cache-ref="simple"
                      passivation-disabled-cache-ref="simple"/>
            <singleton default-access-timeout="5000"/>
         </session-bean>
         <pools>
            <bean-instance-pools>
               <strict-max-pool name="slsb-strict-max-pool"
                                max-pool-size="20"
                                instance-acquisition-timeout="5"
                                instance-acquisition-timeout-unit="MINUTES"/>
               <strict-max-pool name="mdb-strict-max-pool"
                                max-pool-size="20"
                                instance-acquisition-timeout="5"
                                instance-acquisition-timeout-unit="MINUTES"/>
            </bean-instance-pools>
         </pools>
         <caches>
            <cache name="simple"/>
            <cache name="distributable"
                   passivation-store-ref="infinispan"
                   aliases="passivating clustered"/>
         </caches>
         <passivation-stores>
            <passivation-store name="infinispan" cache-container="ejb" max-size="10000"/>
         </passivation-stores>
         <async thread-pool-name="default"/>
         <timer-service thread-pool-name="default" default-data-store="default-file-store">
            <data-stores>
               <file-data-store name="default-file-store"
                                path="timer-service-data"
                                relative-to="jboss.server.data.dir"/>
            </data-stores>
         </timer-service>
         <remote connector-ref="http-remoting-connector"
                 thread-pool-name="default"
                 execute-in-worker="false"/>
         <thread-pools>
            <thread-pool name="default">
               <max-threads count="10"/>
               <keepalive-time time="100" unit="milliseconds"/>
            </thread-pool>
         </thread-pools>
         <default-missing-method-permissions-deny-access value="true"/>
      </subsystem>
      <subsystem xmlns="urn:wildfly:elytron:10.0"
                 final-providers="combined-providers"
                 disallowed-providers="OracleUcrypto">
         <providers>
            <aggregate-providers name="combined-providers">
               <providers name="elytron"/>
               <providers name="openssl"/>
            </aggregate-providers>
            <provider-loader name="elytron" module="org.wildfly.security.elytron"/>
            <provider-loader name="openssl" module="org.wildfly.openssl"/>
         </providers>
         <audit-logging>
            <file-audit-log name="local-audit"
                            path="audit.log"
                            relative-to="jboss.server.log.dir"
                            format="JSON"/>
         </audit-logging>
         <mappers>
            <simple-permission-mapper name="default-permission-mapper" mapping-mode="first">
               <permission-mapping>
                  <principal name="anonymous"/>
                  <permission-set name="default-permissions"/>
               </permission-mapping>
               <permission-mapping match-all="true">
                  <permission-set name="login-permission"/>
                  <permission-set name="default-permissions"/>
               </permission-mapping>
            </simple-permission-mapper>
            <constant-realm-mapper name="local" realm-name="local"/>
            <simple-role-decoder name="groups-to-roles" attribute="groups"/>
            <constant-role-mapper name="super-user-mapper">
               <role name="SuperUser"/>
            </constant-role-mapper>
         </mappers>
         <permission-sets>
            <permission-set name="login-permission">
               <permission class-name="org.wildfly.security.auth.permission.LoginPermission"/>
            </permission-set>
            <permission-set name="default-permissions">
               <permission class-name="org.wildfly.extension.batch.jberet.deployment.BatchPermission"
                           module="org.wildfly.extension.batch.jberet"
                           target-name="*"/>
               <permission class-name="org.wildfly.transaction.client.RemoteTransactionPermission"
                           module="org.wildfly.transaction.client"/>
               <permission class-name="org.jboss.ejb.client.RemoteEJBPermission"
                           module="org.jboss.ejb-client"/>
            </permission-set>
         </permission-sets>
         <credential-stores>
            <credential-store name="px-credential-store"
                              relative-to="jboss.server.base.dir"
                              location="vault/pxs_elytron.store"
                              modifiable="false"
                              create="false">
               <implementation-properties/>
               <credential-reference clear-text="${env.ELYTRON_KEYSTORE_PASSWORD}"/>
            </credential-store>
         </credential-stores>
         <!--
Hey so we're using the legacy JAAS authentication mechanisms, which use the management/security configuration and the security subsystem
for authentication logic, rather than this Elytron magic. It seems like that old security mechanism will be removed eventually, but for
now I didn't see any benefit in trying to use this one right now.
At some point you'll need to uncomment this I suppose, in which case... good luck!

            <security-domains>
                <security-domain name="ApplicationDomain" default-realm="ApplicationRealm" permission-mapper="default-permission-mapper">
                    <realm name="ApplicationRealm" role-decoder="groups-to-roles"/>
                    <realm name="local"/>
                </security-domain>
                <security-domain name="ManagementDomain" default-realm="ManagementRealm" permission-mapper="default-permission-mapper">
                    <realm name="ManagementRealm" role-decoder="groups-to-roles"/>
                    <realm name="local" role-mapper="super-user-mapper"/>
                </security-domain>
            </security-domains>
            <security-realms>
                <identity-realm name="local" identity="$local"/>
                <properties-realm name="ApplicationRealm">
                    <users-properties path="application-users.properties" relative-to="jboss.server.config.dir" digest-realm-name="ApplicationRealm"/>
                    <groups-properties path="application-roles.properties" relative-to="jboss.server.config.dir"/>
                </properties-realm>
                <properties-realm name="ManagementRealm">
                    <users-properties path="mgmt-users.properties" relative-to="jboss.server.config.dir" digest-realm-name="ManagementRealm"/>
                    <groups-properties path="mgmt-groups.properties" relative-to="jboss.server.config.dir"/>
                </properties-realm>
            </security-realms>
            <http>
                <http-authentication-factory name="management-http-authentication" security-domain="ManagementDomain" http-server-mechanism-factory="global">
                    <mechanism-configuration>
                        <mechanism mechanism-name="DIGEST">
                            <mechanism-realm realm-name="ManagementRealm"/>
                        </mechanism>
                    </mechanism-configuration>
                </http-authentication-factory>
                <http-authentication-factory name="application-http-authentication" security-domain="ApplicationDomain" http-server-mechanism-factory="global">
                    <mechanism-configuration>
                        <mechanism mechanism-name="BASIC">
                            <mechanism-realm realm-name="ApplicationRealm"/>
                        </mechanism>
                        <mechanism mechanism-name="FORM"/>
                    </mechanism-configuration>
                </http-authentication-factory>
                <provider-http-server-mechanism-factory name="global"/>
            </http>
            <sasl>
                <sasl-authentication-factory name="management-sasl-authentication" sasl-server-factory="configured" security-domain="ManagementDomain">
                    <mechanism-configuration>
                        <mechanism mechanism-name="JBOSS-LOCAL-USER" realm-mapper="local"/>
                        <mechanism mechanism-name="DIGEST-MD5">
                            <mechanism-realm realm-name="ManagementRealm"/>
                        </mechanism>
                    </mechanism-configuration>
                </sasl-authentication-factory>
                <sasl-authentication-factory name="application-sasl-authentication" sasl-server-factory="configured" security-domain="ApplicationDomain">
                    <mechanism-configuration>
                        <mechanism mechanism-name="JBOSS-LOCAL-USER" realm-mapper="local"/>
                        <mechanism mechanism-name="DIGEST-MD5">
                            <mechanism-realm realm-name="ApplicationRealm"/>
                        </mechanism>
                    </mechanism-configuration>
                </sasl-authentication-factory>
                <configurable-sasl-server-factory name="configured" sasl-server-factory="elytron">
                    <properties>
                        <property name="wildfly.sasl.local-user.default-user" value="$local"/>
                    </properties>
                </configurable-sasl-server-factory>
                <mechanism-provider-filtering-sasl-server-factory name="elytron" sasl-server-factory="global">
                    <filters>
                        <filter provider-name="WildFlyElytron"/>
                    </filters>
                </mechanism-provider-filtering-sasl-server-factory>
                <provider-sasl-server-factory name="global"/>
            </sasl>
-->
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:infinispan:10.0">
         <cache-container name="web"
                          default-cache="passivation"
                          module="org.wildfly.clustering.web.infinispan">
            <local-cache name="passivation">
               <transaction mode="BATCH"/>
               <file-store passivation="true" purge="false"/>
            </local-cache>
            <local-cache name="persistent">
               <transaction mode="BATCH"/>
               <file-store passivation="false" purge="false"/>
            </local-cache>
            <local-cache name="concurrent">
               <file-store passivation="true" purge="false"/>
            </local-cache>
         </cache-container>
         <cache-container name="ejb"
                          aliases="sfsb"
                          default-cache="passivation"
                          module="org.wildfly.clustering.ejb.infinispan">
            <local-cache name="passivation">
               <transaction mode="BATCH"/>
               <file-store passivation="true" purge="false"/>
            </local-cache>
            <local-cache name="persistent">
               <transaction mode="BATCH"/>
               <file-store passivation="false" purge="false"/>
            </local-cache>
         </cache-container>
         <cache-container name="hibernate"
                          default-cache="local-query"
                          module="org.infinispan.hibernate-cache">
            <local-cache name="entity">
               <transaction mode="NON_XA"/>
               <object-memory size="10000"/>
               <expiration max-idle="100000"/>
            </local-cache>
            <local-cache name="local-query">
               <transaction mode="NONE"/>
               <object-memory size="10000"/>
               <expiration max-idle="100000"/>
            </local-cache>
            <local-cache name="timestamps">
               <transaction mode="NONE"/>
            </local-cache>
         </cache-container>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:io:3.0">
         <worker name="default" task-max-threads="1024"/>
         <buffer-pool name="default"/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:jaxrs:2.0"/>
      <subsystem xmlns="urn:jboss:domain:jca:5.0">
         <archive-validation enabled="true" fail-on-error="true" fail-on-warn="false"/>
         <bean-validation enabled="true"/>
         <default-workmanager>
            <short-running-threads>
               <core-threads count="50"/>
               <queue-length count="50"/>
               <max-threads count="50"/>
               <keepalive-time time="10" unit="seconds"/>
            </short-running-threads>
            <long-running-threads>
               <core-threads count="50"/>
               <queue-length count="50"/>
               <max-threads count="50"/>
               <keepalive-time time="10" unit="seconds"/>
            </long-running-threads>
         </default-workmanager>
         <cached-connection-manager/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:jdr:1.0"/>
      <subsystem xmlns="urn:jboss:domain:jmx:1.3">
         <expose-resolved-model/>
         <expose-expression-model/>
         <remoting-connector/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:jpa:1.1">
         <jpa default-datasource="" default-extended-persistence-inheritance="DEEP"/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:jsf:1.1"/>
      <subsystem xmlns="urn:jboss:domain:naming:2.0">
         <remote-naming/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:pojo:1.0"/>
      <subsystem xmlns="urn:jboss:domain:remoting:4.0">
         <endpoint worker="default"/>
         <http-connector name="http-remoting-connector"
                         connector-ref="apiPxsweb"
                         security-realm="ApplicationRealm"/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:resource-adapters:6.0"/>
      <subsystem xmlns="urn:jboss:domain:sar:1.0"/>
      <subsystem xmlns="urn:jboss:domain:security:2.0">
         <security-domains>
            <security-domain xmlns="urn:jboss:domain:13.0" name="web-jsp" cache-type="default">
               <authentication>
                  <login-module code="com.paytronix.thecard.pxserver.database.PxWebJspLoginModule"
                                flag="required">
                     <module-option name="dsJndiName" value="NOT USED"/>
                     <module-option name="principalsQuery" value="NOT USED"/>
                     <module-option name="rolesQuery" value="NOT USED"/>
                     <module-option name="hashAlgorithm" value="SHA"/>
                     <module-option name="hashEncoding" value="base64"/>
                     <module-option name="unauthenticatedIdentity" value="guest"/>
                  </login-module>
               </authentication>
            </security-domain>
            <security-domain name="other" cache-type="default">
               <authentication>
                  <login-module code="Remoting" flag="optional">
                     <module-option name="password-stacking" value="useFirstPass"/>
                  </login-module>
                  <login-module code="RealmDirect" flag="required">
                     <module-option name="password-stacking" value="useFirstPass"/>
                  </login-module>
               </authentication>
            </security-domain>
            <security-domain name="jboss-web-policy" cache-type="default">
               <authorization>
                  <policy-module code="Delegating" flag="required"/>
               </authorization>
            </security-domain>
            <security-domain name="jboss-ejb-policy" cache-type="default">
               <authorization>
                  <policy-module code="Delegating" flag="required"/>
               </authorization>
            </security-domain>
         </security-domains>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:transactions:5.0">
         <core-environment>
            <process-id>
               <uuid/>
            </process-id>
         </core-environment>
         <recovery-environment socket-binding="txn-recovery-environment"
                               status-socket-binding="txn-status-manager"/>
         <object-store relative-to="jboss.server.data.dir"/>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:undertow:11.0">
         <buffer-cache name="default"/>
         <server name="default-server">
            <host name="default-host" alias="localhost">
               <access-log xmlns="urn:jboss:domain:13.0"
                           prefix="localhost_access_log."
                           pattern="%h,%{i,CF-Connecting-IP} %{i,CF-Ray} %l %u %t %{i,Host} &#34;%r&#34; %s %b &#34;%{i,User-Agent}&#34; %D"/>
               <filter-ref name="server-header"/>
               <filter-ref name="x-powered-by-header"/>
               <filter-ref xmlns="urn:jboss:domain:13.0" name="px-disallowed-methods"/>
               <filter-ref xmlns="urn:jboss:domain:13.0" name="px-rest-rewrite-handler"/>
               <filter-ref xmlns="urn:jboss:domain:13.0" name="px-passbook-rewrite-handler"/>
               <filter-ref xmlns="urn:jboss:domain:13.0"
                           name="px-personalizable-pass-url-rewrite-handler"/>
               <filter-ref xmlns="urn:jboss:domain:13.0" name="px-pass-url-by-token-rewrite-handler"/>
               <filter-ref xmlns="urn:jboss:domain:13.0" name="px-pass-by-token-rewrite-handler"/>
               <filter-ref xmlns="urn:jboss:domain:13.0" name="px-jmx-ip-access-restriction"/>
            </host>
            <https-listener xmlns="urn:jboss:domain:13.0"
                            name="apiPxsweb"
                            socket-binding="apiPxsweb"
                            security-realm="apiPxsweb"
                            max-post-size="209715200"
                            max-parameters="5000"
                            read-timeout="3600000"
                            write-timeout="3600000"
                            no-request-timeout="60000"
                            request-parse-timeout="2000"
                            enabled-protocols="TLSv1.2"
                            enabled-cipher-suites="TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA"
                            record-request-start-time="true"
                            tcp-keep-alive="true"
                            enable-http2="true"
                            verify-client="REQUESTED"/>
            <https-listener xmlns="urn:jboss:domain:13.0"
                            name="https-rest"
                            socket-binding="https-rest"
                            security-realm="https-rest"
                            max-post-size="209715200"
                            max-parameters="5000"
                            read-timeout="3600000"
                            write-timeout="3600000"
                            no-request-timeout="60000"
                            request-parse-timeout="2000"
                            enabled-protocols="TLSv1.2"
                            enabled-cipher-suites="TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA"
                            record-request-start-time="true"
                            tcp-keep-alive="true"
                            enable-http2="true"
                            verify-client="REQUESTED"/>
            <https-listener xmlns="urn:jboss:domain:13.0"
                            name="https"
                            socket-binding="https"
                            security-realm="https"
                            max-post-size="209715200"
                            max-parameters="5000"
                            read-timeout="3600000"
                            write-timeout="3600000"
                            no-request-timeout="60000"
                            request-parse-timeout="2000"
                            enabled-protocols="TLSv1.2"
                            enabled-cipher-suites="TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA"
                            record-request-start-time="true"
                            tcp-keep-alive="true"
                            enable-http2="true"/>
         </server>
         <servlet-container name="default" eager-filter-initialization="true">
            <jsp-config/>
            <websockets/>
         </servlet-container>
         <filters>
            <response-header name="server-header" header-name="Server" header-value="PXS"/>
            <response-header name="x-powered-by-header"
                             header-name="X-Powered-By"
                             header-value="PXS"/>
            <filter xmlns="urn:jboss:domain:13.0"
                    name="px-disallowed-methods"
                    class-name="com.paytronix.server.common.httphandler.PxDisallowedMethodHandler"
                    module="com.paytronix.ext.lib"/>
            <filter xmlns="urn:jboss:domain:13.0"
                    name="px-rest-rewrite-handler"
                    class-name="com.paytronix.server.common.httphandler.PxURLRewriteFilter"
                    module="com.paytronix.ext.lib">
               <param name="pattern" value="/rest/(.*)"/>
               <param name="value" value="/api/rest/$1"/>
            </filter>
            <filter xmlns="urn:jboss:domain:13.0"
                    name="px-passbook-rewrite-handler"
                    class-name="com.paytronix.server.common.httphandler.PxURLRewriteFilter"
                    module="com.paytronix.ext.lib">
               <param name="pattern" value="/passbook/(.*)"/>
               <param name="value" value="/api/passbook/$1"/>
            </filter>
            <filter xmlns="urn:jboss:domain:13.0"
                    name="px-personalizable-pass-url-rewrite-handler"
                    class-name="com.paytronix.server.common.httphandler.PxURLRewriteFilter"
                    module="com.paytronix.ext.lib">
               <param name="pattern" value="/ptu/([0-9]+/?)"/>
               <param name="value" value="/api/passbook/personalizablepassurl/$1"/>
            </filter>
            <filter xmlns="urn:jboss:domain:13.0"
                    name="px-pass-url-by-token-rewrite-handler"
                    class-name="com.paytronix.server.common.httphandler.PxURLRewriteFilter"
                    module="com.paytronix.ext.lib">
               <param name="pattern" value="/ptu/([0-9]+/.+)"/>
               <param name="value" value="/api/passbook/passurlbytoken/$1"/>
            </filter>
            <filter xmlns="urn:jboss:domain:13.0"
                    name="px-pass-by-token-rewrite-handler"
                    class-name="com.paytronix.server.common.httphandler.PxURLRewriteFilter"
                    module="com.paytronix.ext.lib">
               <param name="pattern" value="/pt/(.*)"/>
               <param name="value" value="/api/passbook/passbytoken/$1"/>
            </filter>
            <filter xmlns="urn:jboss:domain:13.0"
                    name="px-jmx-ip-access-restriction"
                    class-name="com.paytronix.server.common.httphandler.PxIpAccessControlFilter"
                    module="com.paytronix.ext.lib">
               <param name="urlPrefix" value="/jmx-console"/>
               <param name="ipsRegex"
                      value="127[.]0[.]0[.]1|192[.]168[.]16[.][0-9]+|192[.]168[.]8[.][0-9]+|192[.]168[.]9[.][0-9]+"/>
            </filter>
         </filters>
      </subsystem>
      <subsystem xmlns="urn:jboss:domain:weld:4.0"/>
   </profile>
   <interfaces>
      <interface name="management">
         <any-address/>
      </interface>
      <interface name="public">
         <inet-address value="${jboss.bind.address:127.0.0.1}"/>
      </interface>
      <interface name="unsecure">
         <inet-address value="${jboss.bind.address.unsecure:127.0.0.1}"/>
      </interface>
      <interface name="global">
         <any-address/>
      </interface>
   </interfaces>
   <socket-binding-group name="standard-sockets"
                         default-interface="global"
                         port-offset="${jboss.socket.binding.port-offset:0}">
      <socket-binding name="https-443" port="443"/>
      <socket-binding name="management-http"
                      interface="management"
                      port="${jboss.management.http.port:9990}"/>
      <socket-binding name="management-https"
                      interface="management"
                      port="${jboss.management.https.port:9993}"/>
      <socket-binding name="ajp" port="${jboss.ajp.port:8209}"/>
      <socket-binding name="txn-recovery-environment" port="${jboss.ajp.port:4912}"/>
      <socket-binding name="txn-status-manager" port="${jboss.ajp.port:4913}"/>
      <socket-binding name="apiPxsweb" port="11283"/>
      <socket-binding name="https-rest" port="1283"/>
      <socket-binding name="https" port="1282"/>
   </socket-binding-group>
</server>
